# Envoy

[Envoy](https://www.envoyproxy.io) is used as the side-car to add auth-information for outgoing requests. 
See the ["Use envoy as proxy"-ADR](adr/choose-proxy.md) for the rational of that choice.

In order to support the required [lua-functionality](https://www.lua.org/), dedicated container for [envoy](https://quay.io/repository/wi_stefan/envoy) is provided.
Its a small extension of the official [envoy-docker](https://hub.docker.com/r/envoyproxy/envoy) with the [json-lua library](https://raw.githubusercontent.com/rxi/json.lua/v0.1.2/json.lua) 
already installed. Any other envoy can be used, as long as the library is provided.

## Don't get confused on envoy logs

When running envoy with config generated by the service, don't get confused by the message:
``` 
[info][lua] [source/extensions/filters/http/lua/lua_filter.cc:189] envoy_on_response() function not found. Lua filter will not hook responses.
```
This is expected and intended behaviour. The ```envoy_on_response``` function is optional for lua-filters and allows to add response filtering.
But since the filter is targeting requests(e.g. ```envoy_on_request```) it ignores responses and does not implement such method.
